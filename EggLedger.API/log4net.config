<?xml version="1.0" encoding="utf-8" ?>
<log4net>
  <!-- File Appender for all logs -->
  <appender name="FileAppender" type="log4net.Appender.RollingFileAppender">
    <file type="log4net.Util.PatternString" value="${EGGLEDGER_LOG_PATH}/eggledger-api-.log" />
    <appendToFile value="true" />
    <lockingModel type="log4net.Appender.FileAppender+MinimalLock" />
    <rollingStyle value="Composite" />
    <datePattern value="dd-MM-yyyy" />
    <maxSizeRollBackups value="30" />
    <maximumFileSize value="10MB" />
    <staticLogFileName value="false" />
    <preserveLogFileNameExtension value="true" />
    <layout type="log4net.Layout.PatternLayout">
      <conversionPattern value="%date{yyyy-MM-dd HH:mm:ss.fff} [%thread] %-5level %logger{1} - %message%newline" />
    </layout>
  </appender>

  <!-- Error File Appender for errors and above -->
  <appender name="ErrorFileAppender" type="log4net.Appender.RollingFileAppender">
    <file type="log4net.Util.PatternString" value="${EGGLEDGER_LOG_PATH}/eggledger-api-errors-.log" />
    <appendToFile value="true" />
    <lockingModel type="log4net.Appender.FileAppender+MinimalLock" />
    <rollingStyle value="Composite" />
    <datePattern value="dd-MM-yyyy" />
    <maxSizeRollBackups value="30" />
    <maximumFileSize value="10MB" />
    <staticLogFileName value="false" />
    <preserveLogFileNameExtension value="true" />
    <threshold value="ERROR" />
    <layout type="log4net.Layout.PatternLayout">
      <conversionPattern value="%date{yyyy-MM-dd HH:mm:ss.fff} [%thread] %-5level %logger - %message%newline%exception%newline" />
    </layout>
  </appender>

  <!-- Performance Log Appender for timing and performance metrics -->
  <appender name="PerformanceAppender" type="log4net.Appender.RollingFileAppender">
    <file type="log4net.Util.PatternString" value="${EGGLEDGER_LOG_PATH}/eggledger-api-performance-.log" />
    <appendToFile value="true" />
    <lockingModel type="log4net.Appender.FileAppender+MinimalLock" />
    <rollingStyle value="Composite" />
    <datePattern value="dd-MM-yyyy" />
    <maxSizeRollBackups value="7" />
    <maximumFileSize value="5MB" />
    <staticLogFileName value="false" />
    <preserveLogFileNameExtension value="true" />
    <layout type="log4net.Layout.PatternLayout">
      <conversionPattern value="%date{yyyy-MM-dd HH:mm:ss.fff} [%thread] %-5level %logger{1} - %message%newline" />
    </layout>
  </appender>

  <!-- Security Log Appender for authentication and authorization events -->
  <appender name="SecurityAppender" type="log4net.Appender.RollingFileAppender">
    <file type="log4net.Util.PatternString" value="${EGGLEDGER_LOG_PATH}/eggledger-api-security-.log" />
    <appendToFile value="true" />
    <lockingModel type="log4net.Appender.FileAppender+MinimalLock" />
    <rollingStyle value="Composite" />
    <datePattern value="dd-MM-yyyy" />
    <maxSizeRollBackups value="30" />
    <maximumFileSize value="5MB" />
    <staticLogFileName value="false" />
    <preserveLogFileNameExtension value="true" />
    <layout type="log4net.Layout.PatternLayout">
      <conversionPattern value="%date{yyyy-MM-dd HH:mm:ss.fff} [%thread] %-5level %logger{1} - %message%newline" />
    </layout>
  </appender>

  <!-- Console Appender for development with colors -->
  <appender name="ConsoleAppender" type="log4net.Appender.ConsoleAppender">
    <layout type="log4net.Layout.PatternLayout">
      <conversionPattern value="%date{HH:mm:ss.fff} [%thread] %-5level %logger{1} - %message%newline" />
    </layout>
    <mapping>
      <level value="ERROR" />
      <foreColor value="Red" />
    </mapping>
    <mapping>
      <level value="WARN" />
      <foreColor value="Yellow" />
    </mapping>
    <mapping>
      <level value="INFO" />
      <foreColor value="White" />
    </mapping>
    <mapping>
      <level value="DEBUG" />
      <foreColor value="Gray" />
    </mapping>
  </appender>

  <!-- Database Query Appender for Entity Framework queries -->
  <appender name="DatabaseAppender" type="log4net.Appender.RollingFileAppender">
    <file type="log4net.Util.PatternString" value="${EGGLEDGER_LOG_PATH}/eggledger-api-database-.log" />
    <appendToFile value="true" />
    <lockingModel type="log4net.Appender.FileAppender+MinimalLock" />
    <rollingStyle value="Composite" />
    <datePattern value="dd-MM-yyyy" />
    <maxSizeRollBackups value="7" />
    <maximumFileSize value="10MB" />
    <staticLogFileName value="false" />
    <preserveLogFileNameExtension value="true" />
    <layout type="log4net.Layout.PatternLayout">
      <conversionPattern value="%date{yyyy-MM-dd HH:mm:ss.fff} [%thread] %-5level %logger{1} - %message%newline" />
    </layout>
  </appender>

  <!-- Root logger -->
  <root>
    <level value="INFO" />
    <appender-ref ref="FileAppender" />
    <appender-ref ref="ErrorFileAppender" />
    <appender-ref ref="ConsoleAppender" />
  </root>

  <!-- Application-specific logger configurations -->
  <logger name="EggLedger.API" additivity="false">
    <level value="DEBUG" />
    <appender-ref ref="FileAppender" />
    <appender-ref ref="ErrorFileAppender" />
    <appender-ref ref="ConsoleAppender" />
  </logger>

  <!-- Performance logging -->
  <logger name="EggLedger.API.Performance" additivity="false">
    <level value="INFO" />
    <appender-ref ref="PerformanceAppender" />
    <appender-ref ref="ConsoleAppender" />
  </logger>

  <!-- Security logging -->
  <logger name="EggLedger.API.Security" additivity="false">
    <level value="INFO" />
    <appender-ref ref="SecurityAppender" />
    <appender-ref ref="ConsoleAppender" />
  </logger>

  <!-- Database logging -->
  <logger name="Microsoft.EntityFrameworkCore.Database.Command" additivity="false">
    <level value="INFO" />
    <appender-ref ref="DatabaseAppender" />
    <appender-ref ref="ConsoleAppender" />
  </logger>

  <logger name="Microsoft.EntityFrameworkCore.Query" additivity="false">
    <level value="WARN" />
    <appender-ref ref="DatabaseAppender" />
  </logger>

  <!-- Reduce Microsoft logging noise -->
  <logger name="Microsoft" additivity="false">
    <level value="WARN" />
    <appender-ref ref="FileAppender" />
    <appender-ref ref="ErrorFileAppender" />
  </logger>

  <!-- Reduce System logging noise -->
  <logger name="System" additivity="false">
    <level value="WARN" />
    <appender-ref ref="FileAppender" />
    <appender-ref ref="ErrorFileAppender" />
  </logger>

  <!-- HTTP request logging -->
  <logger name="Microsoft.AspNetCore.Hosting.Diagnostics" additivity="false">
    <level value="INFO" />
    <appender-ref ref="FileAppender" />
    <appender-ref ref="ConsoleAppender" />
  </logger>

  <!-- Authentication logging -->
  <logger name="Microsoft.AspNetCore.Authentication" additivity="false">
    <level value="INFO" />
    <appender-ref ref="SecurityAppender" />
    <appender-ref ref="ConsoleAppender" />
  </logger>

  <!-- Authorization logging -->
  <logger name="Microsoft.AspNetCore.Authorization" additivity="false">
    <level value="INFO" />
    <appender-ref ref="SecurityAppender" />
    <appender-ref ref="ConsoleAppender" />
  </logger>
</log4net>